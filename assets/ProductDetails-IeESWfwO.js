import{a7 as Q,c as k,u as B,d as K,r as b,a as D,j as t,D as T,C as x,m as f,a6 as h,B as v,a8 as O,a9 as R,aa as M}from"./index-eM_4p6Ew.js";import{C as w}from"./ChartContainer-LU-DVT04.js";import{D as N}from"./DataTable-CcG1Vlhh.js";import{C as g}from"./CardContent-DwSrEtwi.js";import"./DefaultPropsProvider-WaqG-XDX.js";import"./input-B9U4sB8w.js";function Y(){const s=Q().state,u=k(),P=B(),{data:l,isLoading:H,error:z}=K({queryKey:["product",s.id],queryFn:()=>M(s.id),enabled:!!s.id}),[c,y]=b.useState(s||{}),[q,j]=b.useState(!1);b.useEffect(()=>{s&&y(s)},[s]);const d=D({mutationFn:e=>O(s.id,e),onSuccess:()=>{alert("✅ تم حفظ التعديلات بنجاح"),j(!1)},onError:()=>{alert("❌ حدث خطأ أثناء الحفظ")}}),C=(e,r)=>{y(a=>({...a,[e]:r})),j(!0)},S=D({mutationFn:e=>R(e),onSuccess:()=>{P.invalidateQueries({queryKey:["products-table"]}),alert("تم حذف المنتج"),u("/products")},onError:()=>{alert("فشل الحذف")}}),I=[{key:"id",label:"الرمز",sortable:!0,hidden:!0},{key:"totalPrice",label:"اجمالي السعر",sortable:!0},{key:"supplierName",label:"اسم المورد",sortable:!0},{key:"supplierId",label:"اسم المورد",sortable:!0,hidden:!0},{key:"quantity",label:"الكمية",sortable:!0},{key:"date",label:"التاريخ",sortable:!0}],E=[{key:"id",label:"الرمز",sortable:!0,hidden:!0},{key:"totalPrice",label:"اجمالي السعر",sortable:!0},{key:"customerName",label:"اسم الزبون",sortable:!0},{key:"customerId",label:"اسم الزبون",sortable:!0,hidden:!0},{key:"quantity",label:"الكمية",sortable:!0},{key:"date",label:"التاريخ",sortable:!0}];function F(e){const r=e.purchases.reduce((o,n)=>o+n.quantity,0),a=e.sells.reduce((o,n)=>o+n.quantity,0),m=e.product.quantity;return[{name:"الكمية المشترات",value:r},{name:"الكمية المباعة",value:a},{name:"الكمية المتبقية",value:m}]}function L(e){var r;return(r=e==null?void 0:e.sells)==null?void 0:r.map(a=>{const m=a.products.reduce((p,i)=>p+i.qty*i.sellPrice,0),o=a.products.reduce((p,i)=>p+i.qty*i.payPrice,0),n=m-o;return{name:new Date(a.date).toLocaleDateString(),profit:n.toFixed(3)}})}return t.jsxs(T,{children:[t.jsxs(x,{children:[t.jsxs(f,{className:"flex justify-between items-center",children:[t.jsx(h,{children:"المعلومات الأساسية"}),q&&t.jsx(v,{onClick:()=>d.mutate(c),disabled:d.isPending,children:d.isPending?"جارٍ الحفظ...":"حفظ التعديلات"})]}),t.jsxs(g,{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[c&&Object.entries(c).map(([e,r])=>e==="id"?null:t.jsxs("p",{className:"flex gap-2 relative group mb-4 items-end",children:[t.jsxs("label",{className:"block font-bold w-36",children:[e=="payPrice"?"سعر الشراء":e=="unit"?"الواحدة":e=="updatedDate"?"اخر تعديل":e=="code"?"الرمز":e=="warehouse"?"المخزن":e=="sellPrice"?"سعر المبيع":e=="quantity"?"الكمية":e=="category"?"الفئة":e=="name"?"الاسم":e,":"]}),e.includes("date")&&new Date(r).toString()!=="Invalid Date"?t.jsx("input",{type:"text",value:new Date(r).toLocaleString("en-GB"),onChange:a=>C(e,a.target.value),className:"bg-transparent border-b-2 border-transparent focus:border-primary-500 outline-none transition-all w-full"}):t.jsx("input",{type:"text",value:r,onChange:a=>C(e,a.target.value),className:"bg-transparent border-b-2 border-transparent focus:border-primary-500 outline-none transition-all w-full"}),t.jsx("span",{className:"absolute bottom-0 right-0 w-full h-[2px] bg-primary-500 scale-x-0 group-hover:scale-x-100 origin-right transition-transform duration-300"})]},e)),t.jsx(v,{className:"col-span-2",variant:"destructive",onClick:()=>window.confirm("هل انت متأكد من عملية الحذف")?S.mutate(s.id):{},children:"حذف المنتج"})]})]}),t.jsxs(x,{children:[t.jsx(f,{children:t.jsx(h,{children:"نظرة عامة"})}),t.jsxs(g,{className:"grid md:grid-cols-2 gap-4",children:[t.jsx(w,{title:"المشتريات vs المبيعات vs المخزون",data:l?F(l):[],dataKey:"value",type:"pie"}),t.jsx(w,{title:"المرابح",type:"bar",data:l?L(l):[],dataKey:"profit"})]})]}),t.jsxs(x,{children:[t.jsx(f,{children:t.jsx(h,{children:"جداول البيانات"})}),t.jsxs(g,{className:"flex flex-col md:flex-row gap-4",children:[t.jsx(N,{className:"w-full",title:"عمليات الشراء",data:l?Object.values(l.purchases):[],columns:I,onRowClick:e=>{u("/SupplierDetails",{state:{id:e.supplierId}})}}),t.jsx(N,{className:"w-full",title:"عمليات البيع",data:l?Object.values(l.sells):[],columns:E,onRowClick:e=>{u("/customerDetails",{state:{id:e.customerId}})}})]})]})]})}export{Y as default};
