import{k as f,r as o,f as D,e as g,j as t,J as h}from"./index-CjkZiZSH.js";import{D as n}from"./DataTable-DMCrox0U.js";import{D as F}from"./badge-BuRiJ7vp.js";import{B as x}from"./button-BgzGu4Sa.js";import{P as S,F as p}from"./FormInput-ZUc2U5_b.js";import{e as q}from"./transaction-BYWW-0Q4.js";import{u as v}from"./useMutation-2hLPBwUX.js";import"./table-BMBfgQsc.js";import"./card-BqDxa_jD.js";import"./input-BnqY-c5L.js";import"./search-Bz7BPxDg.js";import"./user-CdSRfBsv.js";import"./house-DPQolJEK.js";async function w(){try{const e=await f.get("/api/exchange/getAll");return console.log(e),e.data}catch(e){throw console.error("خطأ :",e),new Error("خطأ أثناء جلب الصرفيات")}}async function A(){try{const e=await f.get("/api/doneExchange/getAll");return console.log(e),e.data}catch(e){throw console.error("خطأ :",e),new Error("خطأ أثناء جلب الصرفيات المنجزة")}}function H(){const[e,l]=o.useState(!1),[s,u]=o.useState(0),[c,i]=o.useState(0),m=D(),{data:b,isLoading:R}=g({queryKey:["exchange-table"],queryFn:()=>w()}),{data:y,isLoading:_}=g({queryKey:["doneExchange-table"],queryFn:()=>A()}),d=[{label:"ID",key:"id",hidden:!0,sortable:!0},{label:"المبلغ من",key:"amount_from",sortable:!0},{label:"العملة من",key:"fromCurrency",sortable:!0},{label:"المبلغ إلى",key:"amount_to",sortable:!0},{label:"العملة إلى",key:"toCurrency",sortable:!0},{label:"سعر الصرف",key:"rate",sortable:!0},{label:"التاريخ",key:"date",sortable:!0}],k=[{label:"ID",key:"id",hidden:!0,sortable:!0},{label:"المبلغ بعد التحويل",key:"amount_final",sortable:!0},{label:"سعر التحويل",key:"finalRate",sortable:!0},{label:"الفرق عن المتوقع",key:"exchangeDifference",sortable:!0},{label:"المبلغ من",key:"amount_from",sortable:!0},{label:"العملة من",key:"fromCurrency",sortable:!0},{label:"المبلغ إلى",key:"amount_to",sortable:!0},{label:"العملة إلى",key:"toCurrency",sortable:!0},{label:"سعر الصرف",key:"rate",sortable:!0},{label:"التاريخ",key:"date",sortable:!0}],E=v({mutationFn:a=>q(a),onSuccess:()=>{h.success("تم إضافة الدفعة بنجاح!"),u(0),i(0),l(!1),m.invalidateQueries({queryKey:["exchange-table"]}),m.invalidateQueries({queryKey:["doneExchange-table"]})},onError:a=>{console.error(a),h.error("حدث خطأ أثناء إنهاء التحويل")}}),j=async(a,r)=>{a.preventDefault();try{E.mutate({exchangeData:r,realRate:c,amount_final:s,id:r.id})}catch(C){console.error("حدث خطأ أثناء إنهاء التحويل:",C)}};return t.jsxs(F,{children:[t.jsx(n,{title:"عمليات بحاجة الى تحويل",data:b||[],columns:d,renderRowActions:a=>t.jsxs(S,{title:"انهاء عملية التحويل",isOpen:e,setIsOpen:l,trigger:t.jsx(x,{children:"تحويل"}),children:[t.jsx(n,{searchable:!1,title:"",data:[a],pageSizeOptions:[1],defaultPageSize:1,columns:d}),t.jsxs("form",{className:"space-y-4",onSubmit:r=>j(r,a),action:"",children:[t.jsx(p,{label:"القيمة المدفوعة للتحويل",value:s,onChange:r=>u(Number(r.target.value))}),t.jsx(p,{label:"سعر التحويل",value:c,onChange:r=>i(Number(r.target.value))}),t.jsx(x,{className:"w-full",type:"submit",children:"انهاء العملية"})]})]})}),t.jsx(n,{title:"عمليات التحويل المنتهية",data:y||[],columns:k})]})}export{H as default};
