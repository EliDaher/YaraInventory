import{z as T,l as R,f as G,e as J,r as d,J as u,j as t,L as M,B as W,D as z,E as H}from"./index-Os8Og7uJ.js";import{C as q}from"./ChartContainer-D2mEeFzb.js";import{D as y}from"./DataTable-DlfUubZH.js";import{D as P}from"./badge-CTYeo7Ag.js";import{C as x,a as h,b as j}from"./card-BPl_Jv0_.js";import{u as S}from"./useMutation-RhoykwT-.js";import{B as g}from"./button-BUEtkSAn.js";import{A as V}from"./arrow-left-BONgGXyW.js";import{C as w}from"./CardContent-De57J35Y.js";import"./DefaultPropsProvider-D2rmHRYn.js";import"./table-8cJrdKEp.js";import"./input-ClXgIDJM.js";import"./search-D-IYHy0B.js";import"./house-ClFp9T6b.js";function ue(){const l=T().state,m=R(),B=G(),{data:a,isLoading:I,error:v}=J({queryKey:["product",l.id],queryFn:()=>H(l.id),enabled:!!l.id});d.useEffect(()=>{v&&(u.error("حدث خطأ أثناء جلب البيانات، سيتم العودة للصفحة السابقة."),window.history.back())},[v]);const[c,C]=d.useState(l||{}),[k,D]=d.useState(!1);d.useEffect(()=>{l&&C(l)},[l]);const b=S({mutationFn:e=>W(l.id,e),onSuccess:()=>{u.success("✅ تم حفظ التعديلات بنجاح"),D(!1)},onError:()=>{u.error("❌ حدث خطأ أثناء الحفظ")}}),N=(e,s)=>{C(r=>({...r,[e]:s})),D(!0)},L=Object.values(c).every(e=>String(e??"").trim()!==""),E=S({mutationFn:e=>z(e),onSuccess:()=>{B.invalidateQueries({queryKey:["products-table"]}),u.success("تم حذف المنتج"),m("/products")},onError:()=>{u.error("فشل الحذف")}}),F=[{key:"referenceId",label:"رقم العملية",sortable:!0,hidden:!0},{key:"productName",label:"المنتج",sortable:!0},{key:"fromWarehouse",label:"من مستودع",sortable:!0},{key:"toWarehouse",label:"إلى مستودع",sortable:!0},{key:"quantity",label:"الكمية",sortable:!0},{key:"stockBefore",label:"المخزون قبل",sortable:!0},{key:"stockAfter",label:"المخزون بعد",sortable:!0},{key:"cost",label:"تكلفة النقل",sortable:!0},{key:"currency",label:"العملة",sortable:!0},{key:"performedBy",label:"المنفذ",sortable:!0,hidden:!0},{key:"createdAt",label:"التاريخ",sortable:!0},{key:"note",label:"ملاحظات"}],Q=[{key:"id",label:"الرمز",sortable:!0,hidden:!0},{key:"totalPrice",label:"اجمالي السعر",sortable:!0},{key:"supplierName",label:"اسم المورد",sortable:!0},{key:"supplierId",label:"اسم المورد",sortable:!0,hidden:!0},{key:"quantity",label:"الكمية",sortable:!0},{key:"date",label:"التاريخ",sortable:!0}],O=[{key:"id",label:"الرمز",sortable:!0,hidden:!0},{key:"totalPrice",label:"اجمالي السعر",sortable:!0},{key:"customerName",label:"اسم الزبون",sortable:!0},{key:"customerId",label:"اسم الزبون",sortable:!0,hidden:!0},{key:"quantity",label:"الكمية",sortable:!0},{key:"date",label:"التاريخ",sortable:!0}];function A(e){console.log(e);const s=e.purchases.reduce((n,o)=>n+o.quantity,0),r=e.sells.reduce((n,o)=>n+o.quantity,0),p=e.transfers.reduce((n,o)=>n+o.quantity,0),f=e.product.quantity;return[{name:"الكمية المشترات",value:s},{name:"الكمية المباعة",value:r},{name:"الكمية المنقولة",value:p},{name:"الكمية المتبقية",value:f}]}function K(e){var s;return(s=e==null?void 0:e.sells)==null?void 0:s.map(r=>{const p=r.products.reduce((o,i)=>o+i.qty*i.sellPrice,0),f=r.products.reduce((o,i)=>o+i.qty*i.payPrice,0),n=p-f;return{name:new Date(r.date).toLocaleDateString(),profit:n.toFixed(3)}})}return I?t.jsx(P,{children:t.jsx(M,{})}):t.jsxs(P,{children:[t.jsxs(x,{children:[t.jsxs(h,{className:"flex flex-row-reverse justify-between items-center",children:[t.jsxs(g,{className:"",variant:"outline",onClick:()=>window.history.back(),children:[t.jsx(V,{className:""}),"Go Back"]}),t.jsx(j,{children:"المعلومات الأساسية"})]}),t.jsxs(w,{className:"flex flex-wrap gap-2",children:[c&&Object.entries(c).map(([e,s])=>e==="id"?null:t.jsxs("p",{className:"flex gap-2 relative group mb-4 items-end",children:[t.jsxs("label",{className:"block font-bold w-36",children:[e=="payPrice"?"سعر الشراء":e=="unit"?"الواحدة":e=="updatedDate"?"اخر تعديل":e=="code"?"الرمز":e=="warehouse"?"المخزن":e=="sellPrice"?"سعر المبيع":e=="quantity"?"الكمية":e=="category"?"الفئة":e=="name"?"الاسم":e,":"]}),e.includes("date")&&new Date(s).toString()!=="Invalid Date"?t.jsx("input",{type:"text",value:new Date(s).toLocaleString("en-GB"),onChange:r=>N(e,r.target.value),className:"bg-transparent border-b-2 border-transparent focus:border-primary-500 outline-none transition-all w-full"}):t.jsx("input",{type:"text",value:s,onChange:r=>N(e,r.target.value),className:"bg-transparent border-b-2 border-transparent focus:border-primary-500 outline-none transition-all w-full"}),t.jsx("span",{className:"absolute bottom-0 right-0 w-full h-[2px] bg-primary-500 scale-x-0 group-hover:scale-x-100 origin-right transition-transform duration-300"})]},e)),t.jsxs("div",{className:"col-span-2 w-full grid grid-cols-2 gap-4",children:[k&&L&&t.jsx(g,{onClick:()=>b.mutate(c),disabled:b.isPending,children:b.isPending?"جارٍ الحفظ...":"حفظ التعديلات"}),t.jsx(g,{className:k?"":"col-span-2",variant:"destructive",onClick:()=>window.confirm("هل انت متأكد من عملية الحذف")?E.mutate(l.id):{},children:"حذف المنتج"})]})]})]}),t.jsxs(x,{children:[t.jsx(h,{children:t.jsx(j,{children:"نظرة عامة"})}),t.jsxs(w,{className:"grid md:grid-cols-2 gap-4",children:[t.jsx(q,{title:"المشتريات vs المبيعات vs المخزون",data:a?A(a):[],dataKey:"value",type:"pie"}),t.jsx(q,{title:"المرابح",type:"bar",data:a?K(a):[],dataKey:"profit"})]})]}),t.jsxs(x,{children:[t.jsx(h,{children:t.jsx(j,{children:"جداول البيانات"})}),t.jsxs(w,{className:"flex flex-row flex-wrap gap-4",children:[t.jsx(y,{className:"w-full md:w-[48%]",title:"عمليات الشراء",data:a?Object.values(a.transfers):[],columns:F}),t.jsx(y,{className:"w-full md:w-[48%]",title:"عمليات الشراء",data:a?Object.values(a.purchases):[],columns:Q,onRowClick:e=>{m("/SupplierDetails",{state:{id:e.supplierId}})}}),t.jsx(y,{className:"w-full md:w-[48%]",title:"عمليات البيع",data:a?Object.values(a.sells):[],columns:O,onRowClick:e=>{m("/customerDetails",{state:{id:e.customerId}})}})]})]})]})}export{ue as default};
