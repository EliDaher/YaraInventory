import{a5 as B,b as F,u as K,c as T,r as m,a as j,j as t,D as I,C as p,k as b,a4 as x,B as C}from"./index-D7nPXooX.js";import{C as v}from"./ChartContainer-CN5qngKS.js";import{D}from"./DataTable-CGXqz8Nn.js";import{u as O,d as M,a as k}from"./products-BoocpUMw.js";import{C as f}from"./CardContent-CMWPA5vr.js";import"./DefaultPropsProvider-CEk_anle.js";import"./input-BFu5unLX.js";function Y(){const r=B().state,N=F(),w=K(),{data:n,isLoading:H,error:R}=T({queryKey:["product",r.id],queryFn:()=>k(r.id),enabled:!!r.id}),[u,h]=m.useState(r||{}),[P,g]=m.useState(!1);m.useEffect(()=>{r&&h(r)},[r]);const c=j({mutationFn:e=>O(r.id,e),onSuccess:()=>{alert("✅ تم حفظ التعديلات بنجاح"),g(!1)},onError:()=>{alert("❌ حدث خطأ أثناء الحفظ")}}),y=(e,a)=>{h(s=>({...s,[e]:a})),g(!0)},q=j({mutationFn:e=>M(e),onSuccess:()=>{w.invalidateQueries({queryKey:["products-table"]}),alert("تم حذف المنتج"),N("/products")},onError:()=>{alert("فشل الحذف")}}),S=[{key:"id",label:"الرمز",sortable:!0,hidden:!0},{key:"totalPrice",label:"اجمالي السعر",sortable:!0},{key:"supplierName",label:"اسم المورد",sortable:!0},{key:"quantity",label:"الكمية",sortable:!0},{key:"date",label:"التاريخ",sortable:!0}],E=[{key:"id",label:"الرمز",sortable:!0,hidden:!0},{key:"totalPrice",label:"اجمالي السعر",sortable:!0},{key:"customerName",label:"اسم المورد",sortable:!0},{key:"quantity",label:"الكمية",sortable:!0},{key:"date",label:"التاريخ",sortable:!0}];function L(e){const a=e.purchases.reduce((o,l)=>o+l.quantity,0),s=e.sells.reduce((o,l)=>o+l.quantity,0),d=e.product.quantity;return[{name:"الكمية المشترات",value:a},{name:"الكمية المباعة",value:s},{name:"الكمية المتبقية",value:d}]}function Q(e){return e.sells.map(a=>{const s=a.products.reduce((l,i)=>l+i.qty*i.sellPrice,0),d=a.products.reduce((l,i)=>l+i.qty*i.payPrice,0),o=s-d;return{name:new Date(a.date).toLocaleDateString(),profit:o}})}return t.jsxs(I,{children:[t.jsxs(p,{children:[t.jsxs(b,{className:"flex justify-between items-center",children:[t.jsx(x,{children:"المعلومات الأساسية"}),P&&t.jsx(C,{onClick:()=>c.mutate(u),disabled:c.isPending,children:c.isPending?"جارٍ الحفظ...":"حفظ التعديلات"})]}),t.jsxs(f,{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[u&&Object.entries(u).map(([e,a])=>e==="id"?null:t.jsxs("p",{className:"flex gap-2 relative group mb-4 items-end",children:[t.jsxs("label",{className:"block font-bold w-36",children:[e=="payPrice"?"سعر الشراء":e=="unit"?"الواحدة":e=="updatedDate"?"اخر تعديل":e=="code"?"الرمز":e=="warehouse"?"المخزن":e=="sellPrice"?"سعر المبيع":e=="quantity"?"الكمية":e=="category"?"الفئة":e=="name"?"الاسم":e,":"]}),e.includes("date")&&new Date(a).toString()!=="Invalid Date"?t.jsx("input",{type:"text",value:new Date(a).toLocaleString("en-GB"),onChange:s=>y(e,s.target.value),className:"bg-transparent border-b-2 border-transparent focus:border-primary-500 outline-none transition-all w-full"}):t.jsx("input",{type:"text",value:a,onChange:s=>y(e,s.target.value),className:"bg-transparent border-b-2 border-transparent focus:border-primary-500 outline-none transition-all w-full"}),t.jsx("span",{className:"absolute bottom-0 right-0 w-full h-[2px] bg-primary-500 scale-x-0 group-hover:scale-x-100 origin-right transition-transform duration-300"})]},e)),t.jsx(C,{className:"col-span-2",variant:"destructive",onClick:()=>window.confirm("هل انت متأكد من عملية الحذف")?q.mutate(r.id):{},children:"حذف المنتج"})]})]}),t.jsxs(p,{children:[t.jsx(b,{children:t.jsx(x,{children:"نظرة عامة"})}),t.jsxs(f,{className:"grid md:grid-cols-2 gap-4",children:[t.jsx(v,{title:"المشتريات vs المبيعات vs المخزون",data:n?L(n):[],dataKey:"value",type:"pie"}),t.jsx(v,{title:"المرابح",type:"bar",data:n?Q(n):[],dataKey:"profit"})]})]}),t.jsxs(p,{children:[t.jsx(b,{children:t.jsx(x,{children:"جداول البيانات"})}),t.jsxs(f,{className:"flex flex-col md:flex-row gap-4",children:[t.jsx(D,{className:"w-full",title:"عمليات الشراء",data:n?Object.values(n.purchases):[],columns:S}),t.jsx(D,{className:"w-full",title:"عمليات البيع",data:n?Object.values(n.sells):[],columns:E})]})]})]})}export{Y as default};
