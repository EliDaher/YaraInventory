import{n as f,r as n,u as C,c as m,a as D,j as a,D as F,B as h}from"./index-DedAuGlY.js";import{D as l}from"./DataTable-wi21OHCC.js";import{P as S,F as x}from"./FormInput-YgIorFMR.js";import{e as q}from"./transaction-BHRmm8md.js";import"./input-CJ8UGXAQ.js";async function v(){try{const e=await f.get("/api/exchange/getAll");return console.log(e),e.data}catch(e){throw console.error("خطأ :",e),new Error("خطأ أثناء جلب الصرفيات")}}async function w(){try{const e=await f.get("/api/doneExchange/getAll");return console.log(e),e.data}catch(e){throw console.error("خطأ :",e),new Error("خطأ أثناء جلب الصرفيات المنجزة")}}function Q(){const[e,o]=n.useState(!1),[s,u]=n.useState(0),[c,i]=n.useState(0),b=C(),{data:y,isLoading:A}=m({queryKey:["exchange-table"],queryFn:()=>v()}),{data:d,isLoading:R}=m({queryKey:["doneExchange-table"],queryFn:()=>w()}),g=[{label:"ID",key:"id",hidden:!0,sortable:!0},{label:"المبلغ من",key:"amount_from",sortable:!0},{label:"العملة من",key:"fromCurrency",sortable:!0},{label:"المبلغ إلى",key:"amount_to",sortable:!0},{label:"العملة إلى",key:"toCurrency",sortable:!0},{label:"سعر الصرف",key:"rate",sortable:!0},{label:"التاريخ",key:"date",sortable:!0}],p=[{label:"ID",key:"id",hidden:!0,sortable:!0},{label:"المبلغ بعد التحويل",key:"amount_final",sortable:!0},{label:"سعر التحويل",key:"finalRate",sortable:!0},{label:"الفرق عن المتوقع",key:"exchangeDifference",sortable:!0},{label:"المبلغ من",key:"amount_from",sortable:!0},{label:"العملة من",key:"fromCurrency",sortable:!0},{label:"المبلغ إلى",key:"amount_to",sortable:!0},{label:"العملة إلى",key:"toCurrency",sortable:!0},{label:"سعر الصرف",key:"rate",sortable:!0},{label:"التاريخ",key:"date",sortable:!0}],k=D({mutationFn:t=>q(t),onSuccess:()=>{alert("تم إضافة الدفعة بنجاح!"),u(0),i(0),o(!1),b.invalidateQueries({queryKey:["exchange-table"]}),b.invalidateQueries({queryKey:["doneExchange-table"]})},onError:t=>{console.error(t),alert("حدث خطأ أثناء إضافة المنتج")}}),E=async(t,r)=>{t.preventDefault();try{k.mutate({exchangeData:r,realRate:c,amount_final:s,id:r.id})}catch(j){console.error("حدث خطأ أثناء إنهاء التحويل:",j)}};return a.jsxs(F,{children:[a.jsx(l,{title:"عمليات بحاجة الى تحويل",data:y||[],columns:g,renderRowActions:t=>a.jsxs(S,{title:"انهاء عملية التحويل",isOpen:e,setIsOpen:o,trigger:a.jsx(h,{children:"تحويل"}),children:[a.jsx(l,{searchable:!1,title:"",data:[t],pageSizeOptions:[1],defaultPageSize:1,columns:g}),a.jsxs("form",{className:"space-y-4",onSubmit:r=>E(r,t),action:"",children:[a.jsx(x,{label:"القيمة المدفوعة للتحويل",value:s,onChange:r=>u(Number(r.target.value))}),a.jsx(x,{label:"سعر التحويل",value:c,onChange:r=>i(Number(r.target.value))}),a.jsx(h,{className:"w-full",type:"submit",children:"انهاء العملية"})]})]})}),a.jsx(l,{title:"عمليات التحويل المنتهية",data:d||[],columns:p})]})}export{Q as default};
