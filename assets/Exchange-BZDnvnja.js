import{k as f,r as o,f as D,e as g,j as a,J as h}from"./index-Os8Og7uJ.js";import{D as n}from"./DataTable-DlfUubZH.js";import{D as F}from"./badge-CTYeo7Ag.js";import{B as x}from"./button-BUEtkSAn.js";import{P as S,F as p}from"./FormInput-CGgAf-ka.js";import{e as q}from"./transaction-BBceugoW.js";import{u as v}from"./useMutation-RhoykwT-.js";import"./table-8cJrdKEp.js";import"./card-BPl_Jv0_.js";import"./input-ClXgIDJM.js";import"./search-D-IYHy0B.js";import"./house-ClFp9T6b.js";async function w(){try{const e=await f.get("/api/exchange/getAll");return console.log(e),e.data}catch(e){throw console.error("خطأ :",e),new Error("خطأ أثناء جلب الصرفيات")}}async function A(){try{const e=await f.get("/api/doneExchange/getAll");return console.log(e),e.data}catch(e){throw console.error("خطأ :",e),new Error("خطأ أثناء جلب الصرفيات المنجزة")}}function G(){const[e,l]=o.useState(!1),[s,u]=o.useState(0),[c,i]=o.useState(0),m=D(),{data:b,isLoading:R}=g({queryKey:["exchange-table"],queryFn:()=>w()}),{data:y,isLoading:_}=g({queryKey:["doneExchange-table"],queryFn:()=>A()}),d=[{label:"ID",key:"id",hidden:!0,sortable:!0},{label:"المبلغ من",key:"amount_from",sortable:!0},{label:"العملة من",key:"fromCurrency",sortable:!0},{label:"المبلغ إلى",key:"amount_to",sortable:!0},{label:"العملة إلى",key:"toCurrency",sortable:!0},{label:"سعر الصرف",key:"rate",sortable:!0},{label:"التاريخ",key:"date",sortable:!0}],k=[{label:"ID",key:"id",hidden:!0,sortable:!0},{label:"المبلغ بعد التحويل",key:"amount_final",sortable:!0},{label:"سعر التحويل",key:"finalRate",sortable:!0},{label:"الفرق عن المتوقع",key:"exchangeDifference",sortable:!0},{label:"المبلغ من",key:"amount_from",sortable:!0},{label:"العملة من",key:"fromCurrency",sortable:!0},{label:"المبلغ إلى",key:"amount_to",sortable:!0},{label:"العملة إلى",key:"toCurrency",sortable:!0},{label:"سعر الصرف",key:"rate",sortable:!0},{label:"التاريخ",key:"date",sortable:!0}],E=v({mutationFn:t=>q(t),onSuccess:()=>{h.success("تم إضافة الدفعة بنجاح!"),u(0),i(0),l(!1),m.invalidateQueries({queryKey:["exchange-table"]}),m.invalidateQueries({queryKey:["doneExchange-table"]})},onError:t=>{console.error(t),h.error("حدث خطأ أثناء إنهاء التحويل")}}),j=async(t,r)=>{t.preventDefault();try{E.mutate({exchangeData:r,realRate:c,amount_final:s,id:r.id})}catch(C){console.error("حدث خطأ أثناء إنهاء التحويل:",C)}};return a.jsxs(F,{children:[a.jsx(n,{title:"عمليات بحاجة الى تحويل",data:b||[],columns:d,renderRowActions:t=>a.jsxs(S,{title:"انهاء عملية التحويل",isOpen:e,setIsOpen:l,trigger:a.jsx(x,{children:"تحويل"}),children:[a.jsx(n,{searchable:!1,title:"",data:[t],pageSizeOptions:[1],defaultPageSize:1,columns:d}),a.jsxs("form",{className:"space-y-4",onSubmit:r=>j(r,t),action:"",children:[a.jsx(p,{label:"القيمة المدفوعة للتحويل",value:s,onChange:r=>u(Number(r.target.value))}),a.jsx(p,{label:"سعر التحويل",value:c,onChange:r=>i(Number(r.target.value))}),a.jsx(x,{className:"w-full",type:"submit",children:"انهاء العملية"})]})]})}),a.jsx(n,{title:"عمليات التحويل المنتهية",data:y||[],columns:k})]})}export{G as default};
