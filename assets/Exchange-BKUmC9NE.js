import{h as p,r as n,f as C,u as g,j as a}from"./index-BWmFOvvk.js";import{D as o}from"./DataTable-CY1TwsKE.js";import{u as D,D as F}from"./badge-CVDZ5wrw.js";import{B as h}from"./button-DkKObyqW.js";import{P as S,F as x}from"./FormInput-BFWnl-Us.js";import{e as q}from"./transaction-Ban7EQLG.js";import"./table-Daob2WTk.js";import"./card-Bl_vHJgX.js";import"./input-CjNjdnkP.js";import"./search-D7Hrmcgv.js";import"./house-C0NkjXA-.js";async function v(){try{const e=await p.get("/api/exchange/getAll");return console.log(e),e.data}catch(e){throw console.error("خطأ :",e),new Error("خطأ أثناء جلب الصرفيات")}}async function w(){try{const e=await p.get("/api/doneExchange/getAll");return console.log(e),e.data}catch(e){throw console.error("خطأ :",e),new Error("خطأ أثناء جلب الصرفيات المنجزة")}}function T(){const[e,l]=n.useState(!1),[s,u]=n.useState(0),[c,i]=n.useState(0),b=C(),{data:m,isLoading:A}=g({queryKey:["exchange-table"],queryFn:()=>v()}),{data:y,isLoading:R}=g({queryKey:["doneExchange-table"],queryFn:()=>w()}),d=[{label:"ID",key:"id",hidden:!0,sortable:!0},{label:"المبلغ من",key:"amount_from",sortable:!0},{label:"العملة من",key:"fromCurrency",sortable:!0},{label:"المبلغ إلى",key:"amount_to",sortable:!0},{label:"العملة إلى",key:"toCurrency",sortable:!0},{label:"سعر الصرف",key:"rate",sortable:!0},{label:"التاريخ",key:"date",sortable:!0}],f=[{label:"ID",key:"id",hidden:!0,sortable:!0},{label:"المبلغ بعد التحويل",key:"amount_final",sortable:!0},{label:"سعر التحويل",key:"finalRate",sortable:!0},{label:"الفرق عن المتوقع",key:"exchangeDifference",sortable:!0},{label:"المبلغ من",key:"amount_from",sortable:!0},{label:"العملة من",key:"fromCurrency",sortable:!0},{label:"المبلغ إلى",key:"amount_to",sortable:!0},{label:"العملة إلى",key:"toCurrency",sortable:!0},{label:"سعر الصرف",key:"rate",sortable:!0},{label:"التاريخ",key:"date",sortable:!0}],k=D({mutationFn:t=>q(t),onSuccess:()=>{alert("تم إضافة الدفعة بنجاح!"),u(0),i(0),l(!1),b.invalidateQueries({queryKey:["exchange-table"]}),b.invalidateQueries({queryKey:["doneExchange-table"]})},onError:t=>{console.error(t),alert("حدث خطأ أثناء إضافة المنتج")}}),E=async(t,r)=>{t.preventDefault();try{k.mutate({exchangeData:r,realRate:c,amount_final:s,id:r.id})}catch(j){console.error("حدث خطأ أثناء إنهاء التحويل:",j)}};return a.jsxs(F,{children:[a.jsx(o,{title:"عمليات بحاجة الى تحويل",data:m||[],columns:d,renderRowActions:t=>a.jsxs(S,{title:"انهاء عملية التحويل",isOpen:e,setIsOpen:l,trigger:a.jsx(h,{children:"تحويل"}),children:[a.jsx(o,{searchable:!1,title:"",data:[t],pageSizeOptions:[1],defaultPageSize:1,columns:d}),a.jsxs("form",{className:"space-y-4",onSubmit:r=>E(r,t),action:"",children:[a.jsx(x,{label:"القيمة المدفوعة للتحويل",value:s,onChange:r=>u(Number(r.target.value))}),a.jsx(x,{label:"سعر التحويل",value:c,onChange:r=>i(Number(r.target.value))}),a.jsx(h,{className:"w-full",type:"submit",children:"انهاء العملية"})]})]})}),a.jsx(o,{title:"عمليات التحويل المنتهية",data:y||[],columns:f})]})}export{T as default};
