import{r,u as V,a as A,j as e,B as m,b as B,c as L,D as T}from"./index-D7nPXooX.js";import{D as K}from"./DataTable-CGXqz8Nn.js";import{P as Y,F as u}from"./FormInput-kcfF76vR.js";import{p as W}from"./transaction-B_x3UY6Y.js";import{S as Z,a as _,b as z,c as G,d as H}from"./select-QdBUJMnH.js";import{S as X}from"./SupplierSelect-D0lIFgkh.js";import{g as $}from"./products-BoocpUMw.js";import"./input-BFu5unLX.js";import"./supplier-X5SdwpXN.js";function ee({isOpen:k,setIsOpen:N,row:l}){const[R,f]=r.useState(!1),[o,p]=r.useState(""),[c,S]=r.useState(""),[h,b]=r.useState(""),[g,s]=r.useState(""),[a,y]=r.useState("0"),[x,P]=r.useState("0"),[i,F]=r.useState("0"),[O,C]=r.useState(""),[n,j]=r.useState("cash"),[D,w]=r.useState("0"),[q,I]=r.useState(""),[d,E]=r.useState(""),[v,U]=r.useState(1),J=V();r.useEffect(()=>{l&&(p(l.name),S(l.code),b(l.category),s(l.warehouse),y(l.payPrice),P(l.sellPrice),C(l.unit))},[l]);const M=A({mutationFn:t=>W(t),onSuccess:()=>{alert("تم إضافة المنتج بنجاح!"),p(""),S(""),b(""),s(""),y("0"),P("0"),C(""),F("0"),j("cash"),I(""),N(!1),J.invalidateQueries({queryKey:["products-table"]})},onError:t=>{console.error(t),alert("حدث خطأ أثناء إضافة المنتج")}}),Q=async t=>{if(t.preventDefault(),!o||!c||!h||!g||!a||!x||!O||!i){alert("الرجاء التأكد من البيانات");return}if(!q){alert("الرجاء اختيار المورد");return}if(n!=="debt"&&!d){alert("الرجاء اختيار العملة");return}if(n==="part"&&Number(D)<=0){alert("الرجاء ادخال قيمة الدفعة الجزئية");return}if(n!=="debt"&&d==="SYP"&&v<=0){alert("الرجاء ادخال سعر صرف صحيح");return}if(n==="part"&&Number(D)>=Number(i)*Number(a)){alert("قيمة الدفعة الجزئية لا يمكن ان تكون اكبر من او تساوي المبلغ الكلي");return}M.mutate({newProduct:{name:o,code:c,category:h,warehouse:g,payPrice:Number(a),sellPrice:Number(x),unit:O,quantity:Number(i)},newPurchase:{supplierId:q,name:o,code:c,warehouse:g,quantity:Number(i),payPrice:Number(a),currency:d,exchangeRate:v,amount_base:Number(a)*v,totalPrice:Number(i)*Number(a),paymentStatus:"pending",remainingDebt:n=="debt"?Number(i)*Number(a):n=="cash"?0:Number(i)*Number(a)-(d=="USD"?Number(a):Number((Number(D)/v).toFixed(1)))}}),p(""),S(""),b(""),s(""),y("0"),P("0"),C(""),F("0"),j("cash"),I(""),E("USD"),U(1)};return e.jsx("div",{children:e.jsx(Y,{title:"شراء منتجات",isOpen:k,setIsOpen:N,trigger:e.jsx(e.Fragment,{}),children:e.jsxs("form",{dir:"rtl",onSubmit:Q,className:"grid grid-cols-2 gap-3",children:[e.jsx(u,{id:"productName",label:"اسم المنتج",value:o,onChange:t=>p(t.target.value)}),e.jsx(u,{id:"RMZProduct",label:"رمز المنتج",value:c,onChange:t=>S(t.target.value)}),e.jsx(u,{id:"productCategory",label:"الصنف",value:h,onChange:t=>b(t.target.value)}),e.jsx(u,{id:"invId",label:"المستودع",value:g,onChange:t=>s(t.target.value)}),e.jsx(u,{id:"payPrice",label:"سعر الشراء",value:a,onChange:t=>y(t.target.value)}),e.jsx(u,{id:"sellPrice",label:"سعر المبيع",value:x,onChange:t=>P(t.target.value)}),e.jsx(u,{id:"quantity",label:"الكمية",value:i,onChange:t=>F(t.target.value)}),e.jsx(u,{id:"unit",label:"الواحدة",value:O,onChange:t=>C(t.target.value)}),e.jsxs("div",{className:"col-span-2 grid grid-cols-3 gap-2",children:[e.jsx(m,{onClick:()=>{j("cash")},className:"col-span-1",variant:n==="cash"?"default":"outline",type:"button",children:"نقدا"}),e.jsx(m,{onClick:()=>{j("part")},className:"col-span-1",variant:n==="part"?"default":"outline",type:"button",children:"جزئي"}),e.jsx(m,{onClick:()=>{j("debt")},className:"col-span-1",variant:n==="debt"?"default":"outline",type:"button",children:"دين"})]}),n==="part"&&e.jsx(u,{id:"partPayment",label:"قيمة الدفعة",value:D,onChange:t=>w(t.target.value)}),n!="debt"&&e.jsxs(e.Fragment,{children:[" ",e.jsxs(Z,{value:d,onValueChange:E,children:[e.jsx(_,{className:"w-full mt-6",children:e.jsx(z,{placeholder:"العملة المدفوع بها"})}),e.jsx(G,{children:["SYP","USD"].map(t=>e.jsx(H,{value:t,children:t},t))})]}),e.jsx(u,{id:"exchangeRate",label:"سعر الصرف",value:d=="USD"?1:v,onChange:t=>U(Number(t.target.value)),disabled:d==="USD"})]}),e.jsx(X,{className:"mt-6",isOpen:R,setIsOpen:f,supplierId:q,setSupplierId:I,withDataTable:!0}),e.jsx(m,{className:"col-span-2",type:"submit",children:"اضافة"})]})})})}function ce(){const k=B(),[N,l]=r.useState(!1),[R,f]=r.useState(null),[o,p]=r.useState([]),{data:c,isLoading:S}=L({queryKey:["products-table"],queryFn:$}),h=[{key:"code",label:"الرمز",sortable:!0},{key:"name",label:"الاسم",sortable:!0},{key:"quantity",label:"الكمية",sortable:!0},{key:"warehouse",label:"المخزن",sortable:!0},{key:"sellPrice",label:"سعر المبيع",sortable:!0},{key:"category",label:"الصنف",sortable:!0},{key:"unit",label:"الواحدة",sortable:!0}],b=s=>o.some(a=>JSON.stringify(a)===JSON.stringify(s)),g=s=>{p(a=>b(s)?a.filter(x=>JSON.stringify(x)!==JSON.stringify(s)):[...a,s])};return e.jsx(T,{children:e.jsxs("div",{children:[e.jsx(ee,{isOpen:N,setIsOpen:l,row:R}),e.jsx(K,{title:"قائمة المنتجات",titleButton:e.jsx(m,{onClick:()=>{f(null),l(!0)},children:"إضافة منتج"}),columns:h,data:c?Object.values(c||{}).flatMap(s=>Object.values(s)):[],onRowClick:s=>g(s),getRowClassName:s=>o!=null&&o.some(a=>a===s)?"bg-green-50 hover:bg-green-100":"",renderRowActions:s=>e.jsxs("div",{className:"flex gap-1",children:[e.jsx(m,{variant:"default",onClick:a=>{a.stopPropagation(),f(s),l(!0)},children:"شراء"}),e.jsx(m,{variant:"outline",onClick:a=>{a.stopPropagation(),k("/productDetails",{state:s})},children:"التفاصيل"})]})})]})})}export{ce as default};
