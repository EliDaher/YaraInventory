import{z as K,i as T,f as R,u as G,r as c,j as t}from"./index-H-wgWPw7.js";import{C as D}from"./ChartContainer-DmqImCCI.js";import{D as f}from"./DataTable-Cl6Cf74j.js";import{u as q,D as P}from"./badge-gArzQKeM.js";import{C as y,a as x,b as h}from"./card-C8MkjIzB.js";import{u as M,d as W,a as z}from"./products-BqDbdimG.js";import{B as j}from"./button-CZhGKD8l.js";import{L as H}from"./Loading-Vqq_630M.js";import{A as V}from"./arrow-left-DVT3Bd9K.js";import{C as g}from"./CardContent-DrCDtA0S.js";import"./DefaultPropsProvider-B-m9S4n3.js";import"./table-CU58WfWl.js";import"./input-BZKj_cJR.js";import"./search-CSdeKlk2.js";import"./house-DbJPSTe7.js";function ue(){const l=K().state,d=T(),S=R(),{data:a,isLoading:I,error:w}=G({queryKey:["product",l.id],queryFn:()=>z(l.id),enabled:!!l.id});c.useEffect(()=>{w&&(alert("حدث خطأ أثناء جلب البيانات، سيتم العودة للصفحة السابقة."),window.history.back())},[w]);const[u,v]=c.useState(l||{}),[C,k]=c.useState(!1);c.useEffect(()=>{l&&v(l)},[l]);const m=q({mutationFn:e=>M(l.id,e),onSuccess:()=>{alert("✅ تم حفظ التعديلات بنجاح"),k(!1)},onError:()=>{alert("❌ حدث خطأ أثناء الحفظ")}}),N=(e,s)=>{v(r=>({...r,[e]:s})),k(!0)},L=Object.values(u).every(e=>String(e??"").trim()!==""),B=q({mutationFn:e=>W(e),onSuccess:()=>{S.invalidateQueries({queryKey:["products-table"]}),alert("تم حذف المنتج"),d("/products")},onError:()=>{alert("فشل الحذف")}}),E=[{key:"referenceId",label:"رقم العملية",sortable:!0,hidden:!0},{key:"productName",label:"المنتج",sortable:!0},{key:"fromWarehouse",label:"من مستودع",sortable:!0},{key:"toWarehouse",label:"إلى مستودع",sortable:!0},{key:"quantity",label:"الكمية",sortable:!0},{key:"stockBefore",label:"المخزون قبل",sortable:!0},{key:"stockAfter",label:"المخزون بعد",sortable:!0},{key:"cost",label:"تكلفة النقل",sortable:!0},{key:"currency",label:"العملة",sortable:!0},{key:"performedBy",label:"المنفذ",sortable:!0,hidden:!0},{key:"createdAt",label:"التاريخ",sortable:!0},{key:"note",label:"ملاحظات"}],F=[{key:"id",label:"الرمز",sortable:!0,hidden:!0},{key:"totalPrice",label:"اجمالي السعر",sortable:!0},{key:"supplierName",label:"اسم المورد",sortable:!0},{key:"supplierId",label:"اسم المورد",sortable:!0,hidden:!0},{key:"quantity",label:"الكمية",sortable:!0},{key:"date",label:"التاريخ",sortable:!0}],Q=[{key:"id",label:"الرمز",sortable:!0,hidden:!0},{key:"totalPrice",label:"اجمالي السعر",sortable:!0},{key:"customerName",label:"اسم الزبون",sortable:!0},{key:"customerId",label:"اسم الزبون",sortable:!0,hidden:!0},{key:"quantity",label:"الكمية",sortable:!0},{key:"date",label:"التاريخ",sortable:!0}];function O(e){console.log(e);const s=e.purchases.reduce((n,o)=>n+o.quantity,0),r=e.sells.reduce((n,o)=>n+o.quantity,0),b=e.transfers.reduce((n,o)=>n+o.quantity,0),p=e.product.quantity;return[{name:"الكمية المشترات",value:s},{name:"الكمية المباعة",value:r},{name:"الكمية المنقولة",value:b},{name:"الكمية المتبقية",value:p}]}function A(e){var s;return(s=e==null?void 0:e.sells)==null?void 0:s.map(r=>{const b=r.products.reduce((o,i)=>o+i.qty*i.sellPrice,0),p=r.products.reduce((o,i)=>o+i.qty*i.payPrice,0),n=b-p;return{name:new Date(r.date).toLocaleDateString(),profit:n.toFixed(3)}})}return I?t.jsx(P,{children:t.jsx(H,{})}):t.jsxs(P,{children:[t.jsxs(y,{children:[t.jsxs(x,{className:"flex flex-row-reverse justify-between items-center",children:[t.jsxs(j,{className:"",variant:"outline",onClick:()=>window.history.back(),children:[t.jsx(V,{className:""}),"Go Back"]}),t.jsx(h,{children:"المعلومات الأساسية"})]}),t.jsxs(g,{className:"flex flex-wrap gap-2",children:[u&&Object.entries(u).map(([e,s])=>e==="id"?null:t.jsxs("p",{className:"flex gap-2 relative group mb-4 items-end",children:[t.jsxs("label",{className:"block font-bold w-36",children:[e=="payPrice"?"سعر الشراء":e=="unit"?"الواحدة":e=="updatedDate"?"اخر تعديل":e=="code"?"الرمز":e=="warehouse"?"المخزن":e=="sellPrice"?"سعر المبيع":e=="quantity"?"الكمية":e=="category"?"الفئة":e=="name"?"الاسم":e,":"]}),e.includes("date")&&new Date(s).toString()!=="Invalid Date"?t.jsx("input",{type:"text",value:new Date(s).toLocaleString("en-GB"),onChange:r=>N(e,r.target.value),className:"bg-transparent border-b-2 border-transparent focus:border-primary-500 outline-none transition-all w-full"}):t.jsx("input",{type:"text",value:s,onChange:r=>N(e,r.target.value),className:"bg-transparent border-b-2 border-transparent focus:border-primary-500 outline-none transition-all w-full"}),t.jsx("span",{className:"absolute bottom-0 right-0 w-full h-[2px] bg-primary-500 scale-x-0 group-hover:scale-x-100 origin-right transition-transform duration-300"})]},e)),t.jsxs("div",{className:"col-span-2 w-full grid grid-cols-2 gap-4",children:[C&&L&&t.jsx(j,{onClick:()=>m.mutate(u),disabled:m.isPending,children:m.isPending?"جارٍ الحفظ...":"حفظ التعديلات"}),t.jsx(j,{className:C?"":"col-span-2",variant:"destructive",onClick:()=>window.confirm("هل انت متأكد من عملية الحذف")?B.mutate(l.id):{},children:"حذف المنتج"})]})]})]}),t.jsxs(y,{children:[t.jsx(x,{children:t.jsx(h,{children:"نظرة عامة"})}),t.jsxs(g,{className:"grid md:grid-cols-2 gap-4",children:[t.jsx(D,{title:"المشتريات vs المبيعات vs المخزون",data:a?O(a):[],dataKey:"value",type:"pie"}),t.jsx(D,{title:"المرابح",type:"bar",data:a?A(a):[],dataKey:"profit"})]})]}),t.jsxs(y,{children:[t.jsx(x,{children:t.jsx(h,{children:"جداول البيانات"})}),t.jsxs(g,{className:"flex flex-row flex-wrap gap-4",children:[t.jsx(f,{className:"w-full md:w-[48%]",title:"عمليات الشراء",data:a?Object.values(a.transfers):[],columns:E}),t.jsx(f,{className:"w-full md:w-[48%]",title:"عمليات الشراء",data:a?Object.values(a.purchases):[],columns:F,onRowClick:e=>{d("/SupplierDetails",{state:{id:e.supplierId}})}}),t.jsx(f,{className:"w-full md:w-[48%]",title:"عمليات البيع",data:a?Object.values(a.sells):[],columns:Q,onRowClick:e=>{d("/customerDetails",{state:{id:e.customerId}})}})]})]})]})}export{ue as default};
