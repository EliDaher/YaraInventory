import{c as L,r as y,j as e,P as O,W as z,a0 as F,m as H,h as V,f as Q,D as S,a7 as K,B as p}from"./index-B9Hbub3a.js";import{u as w,B as _}from"./badge-B0P1iBeR.js";import{u as U,d as W,a as $}from"./sells-CjKbTbo1.js";import{C as g,a as P,b as C,c as f}from"./card-DW6a6Si8.js";import{T as G,a as J,b as k,c as m,d as X,e as u}from"./table-Dn0IiQCR.js";import{A as Y}from"./arrow-left-BLzokWtU.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=L("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=L("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);var se="Separator",T="horizontal",ae=["horizontal","vertical"],q=y.forwardRef((c,i)=>{const{decorative:n,orientation:d=T,...s}=c,o=te(d)?d:T,h=n?{role:"none"}:{"aria-orientation":o==="vertical"?o:void 0,role:"separator"};return e.jsx(O.div,{"data-orientation":o,...h,...s,ref:i})});q.displayName=se;function te(c){return ae.includes(c)}var B=q;const I=y.forwardRef(({className:c,orientation:i="horizontal",decorative:n=!0,...d},s)=>e.jsx(B,{ref:s,decorative:n,orientation:i,className:z("shrink-0 bg-border",i==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",c),...d}));I.displayName=B.displayName;function oe(){const c=F(),i=H(),n=c.state,d=V(),{data:s,isLoading:o}=Q({queryKey:["sell-details",n],queryFn:()=>$(n),enabled:!!n}),[l,h]=y.useState([]),[x,b]=y.useState(null);!o&&s&&l.length===0&&h(s.products);const N=w({mutationFn:a=>U(n,a),onSuccess:()=>{alert("تم تحديث الفاتورة بنجاح"),d.invalidateQueries({queryKey:["customer-details",s.customerId]}),i(-1)},onError:a=>{console.error(a),alert("حدث خطأ أثناء تحديث الفاتورة")}}),v=w({mutationFn:a=>W(n,a),onSuccess:()=>{alert("تم حذف الفاتورة بنجاح"),d.invalidateQueries({queryKey:["customer-details",s.customerId]}),i(-1)},onError:a=>{console.error(a),alert("حدث خطأ أثناء حذف الفاتورة")}}),M=(a,t)=>{b({row:a,field:t})},D=(a,t,r)=>{const j=[...l];j[t][r]=a.target.value,h(j)},E=()=>b(null),R=a=>{h(l.filter((t,r)=>r!==a))},A=()=>{N.mutate({id:s.id,data:{products:l,balance:s.totalPrice-l.reduce((a,t)=>a+t.sellPrice*t.qty,0)}})};return o||!s?e.jsx(S,{children:e.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:e.jsx(K,{className:"animate-spin w-8 h-8 text-muted-foreground"})})}):e.jsx(S,{children:e.jsxs("div",{className:"space-y-6 p-6 max-w-5xl mx-auto",children:[e.jsxs(g,{className:"shadow-md",children:[e.jsxs(P,{className:"flex justify-between flex-row-reverse items-center gap-4",children:[e.jsxs(p,{onClick:()=>i(-1),className:"w-24",variant:"outline",children:[e.jsx(Y,{className:"ml-2 w-4 h-4"})," رجوع"]}),e.jsx(C,{className:"text-2xl font-semibold",children:"تفاصيل الفاتورة"})]}),e.jsx(f,{className:"space-y-3 text-sm",children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"اسم الزبون:"}),e.jsx("p",{className:"font-medium",children:s.customerName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"تاريخ العملية:"}),e.jsx("p",{children:s.date})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"العملة:"}),e.jsx("p",{children:s.currency||"غير محددة"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"سعر الصرف:"}),e.jsx("p",{children:s.exchangeRate.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"حالة الدفع:"}),e.jsx(_,{variant:s.paymentStatus==="cash"?"default":s.paymentStatus==="part"?"secondary":"destructive",children:s.paymentStatus==="cash"?"مدفوع":s.paymentStatus==="part"?"مدفوع جزئياً":"دين"})]}),e.jsx("div",{children:e.jsx(p,{variant:"destructive",onClick:()=>{v.mutate({id:s.id,data:{products:l,balance:s.totalPrice-l.reduce((a,t)=>a+t.sellPrice*t.qty,0)}})},disabled:v.isPending,children:v.isPending?"جاري الحذف...":"حذف"})})]})})]}),e.jsxs(g,{className:"shadow-md",children:[e.jsxs(P,{className:"flex justify-between items-center",children:[e.jsx(C,{className:"text-xl font-semibold",children:"المنتجات المباعة"}),e.jsx(p,{variant:"outline",onClick:A,disabled:N.isPending,children:N.isPending?"جاري الحفظ...":e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"ml-2 w-4 h-4"})," حفظ التعديلات"]})})]}),e.jsx(f,{children:e.jsxs(G,{children:[e.jsx(J,{children:e.jsxs(k,{children:[e.jsx(m,{className:"text-right",children:"المنتج"}),e.jsx(m,{className:"text-right",children:"الكود"}),e.jsx(m,{className:"text-right",children:"السعر"}),e.jsx(m,{className:"text-right",children:"الكمية"}),e.jsx(m,{className:"text-right",children:"الإجمالي"}),e.jsx(m,{className:"text-center",children:"إجراء"})]})}),e.jsx(X,{children:l.map((a,t)=>e.jsxs(k,{children:[e.jsx(u,{className:"text-right",children:a.name||"-"}),e.jsx(u,{className:"text-right",children:a.code||"-"}),["sellPrice","qty"].map(r=>e.jsx(u,{onDoubleClick:()=>M(t,r),className:"cursor-pointer",children:(x==null?void 0:x.row)===t&&(x==null?void 0:x.field)===r?e.jsx("input",{autoFocus:!0,type:r==="qty"||r==="sellPrice"?"number":"text",value:a[r],onChange:j=>D(j,t,r),onBlur:E,className:"w-full border rounded px-1 text-right"}):a[r]},r)),e.jsx(u,{className:"text-right",children:(a.sellPrice*a.qty).toLocaleString()}),e.jsx(u,{className:"text-center",children:e.jsx(p,{variant:"destructive",size:"icon",onClick:()=>R(t),children:e.jsx(ee,{className:"w-4 h-4"})})})]},t))})]})})]}),e.jsx(g,{className:"shadow-md",children:e.jsxs(f,{className:"space-y-2 pt-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"المجموع:"}),e.jsx("span",{className:"font-medium",children:s.totalPrice.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"المدفوع:"}),e.jsx("span",{className:"font-medium",children:s.partValue.toLocaleString()})]}),e.jsx(I,{}),e.jsxs("div",{className:"flex justify-between text-lg font-semibold",children:[e.jsx("span",{children:"المتبقي:"}),e.jsx("span",{className:s.remainingDebt>0?"text-red-600":"text-green-600",children:s.remainingDebt.toLocaleString()})]})]})})]})})}export{oe as default};
