import{a0 as K,m as T,h as R,f as G,r as c,j as t,D,L as M,B as f,a1 as W,a2 as H,a3 as V}from"./index-B37bWIRV.js";import{C as q}from"./ChartContainer-Bp1VpTme.js";import{D as y}from"./DataTable-CS_HJ6iR.js";import{C as x,a as h,b as j}from"./card-DLYYdMtX.js";import{u as P}from"./badge-CkJbfXe2.js";import{A as z}from"./arrow-left-BHknfJeO.js";import{C as g}from"./CardContent-B8FJP5Zj.js";import"./DefaultPropsProvider-CeodWBsc.js";import"./table-C05-iM26.js";import"./input-BzYCNeo2.js";import"./search-iA-z61xT.js";function le(){const l=K().state,d=T(),S=R(),{data:r,isLoading:I,error:w}=G({queryKey:["product",l.id],queryFn:()=>V(l.id),enabled:!!l.id});c.useEffect(()=>{w&&(alert("حدث خطأ أثناء جلب البيانات، سيتم العودة للصفحة السابقة."),window.history.back())},[w]);const[u,v]=c.useState(l||{}),[C,k]=c.useState(!1);c.useEffect(()=>{l&&v(l)},[l]);const m=P({mutationFn:e=>W(l.id,e),onSuccess:()=>{alert("✅ تم حفظ التعديلات بنجاح"),k(!1)},onError:()=>{alert("❌ حدث خطأ أثناء الحفظ")}}),N=(e,s)=>{v(a=>({...a,[e]:s})),k(!0)},L=Object.values(u).every(e=>String(e??"").trim()!==""),B=P({mutationFn:e=>H(e),onSuccess:()=>{S.invalidateQueries({queryKey:["products-table"]}),alert("تم حذف المنتج"),d("/products")},onError:()=>{alert("فشل الحذف")}}),E=[{key:"referenceId",label:"رقم العملية",sortable:!0,hidden:!0},{key:"productName",label:"المنتج",sortable:!0},{key:"fromWarehouse",label:"من مستودع",sortable:!0},{key:"toWarehouse",label:"إلى مستودع",sortable:!0},{key:"quantity",label:"الكمية",sortable:!0},{key:"stockBefore",label:"المخزون قبل",sortable:!0},{key:"stockAfter",label:"المخزون بعد",sortable:!0},{key:"cost",label:"تكلفة النقل",sortable:!0},{key:"currency",label:"العملة",sortable:!0},{key:"performedBy",label:"المنفذ",sortable:!0,hidden:!0},{key:"createdAt",label:"التاريخ",sortable:!0},{key:"note",label:"ملاحظات"}],F=[{key:"id",label:"الرمز",sortable:!0,hidden:!0},{key:"totalPrice",label:"اجمالي السعر",sortable:!0},{key:"supplierName",label:"اسم المورد",sortable:!0},{key:"supplierId",label:"اسم المورد",sortable:!0,hidden:!0},{key:"quantity",label:"الكمية",sortable:!0},{key:"date",label:"التاريخ",sortable:!0}],Q=[{key:"id",label:"الرمز",sortable:!0,hidden:!0},{key:"totalPrice",label:"اجمالي السعر",sortable:!0},{key:"customerName",label:"اسم الزبون",sortable:!0},{key:"customerId",label:"اسم الزبون",sortable:!0,hidden:!0},{key:"quantity",label:"الكمية",sortable:!0},{key:"date",label:"التاريخ",sortable:!0}];function O(e){console.log(e);const s=e.purchases.reduce((n,o)=>n+o.quantity,0),a=e.sells.reduce((n,o)=>n+o.quantity,0),b=e.transfers.reduce((n,o)=>n+o.quantity,0),p=e.product.quantity;return[{name:"الكمية المشترات",value:s},{name:"الكمية المباعة",value:a},{name:"الكمية المنقولة",value:b},{name:"الكمية المتبقية",value:p}]}function A(e){var s;return(s=e==null?void 0:e.sells)==null?void 0:s.map(a=>{const b=a.products.reduce((o,i)=>o+i.qty*i.sellPrice,0),p=a.products.reduce((o,i)=>o+i.qty*i.payPrice,0),n=b-p;return{name:new Date(a.date).toLocaleDateString(),profit:n.toFixed(3)}})}return I?t.jsx(D,{children:t.jsx(M,{})}):t.jsxs(D,{children:[t.jsxs(x,{children:[t.jsxs(h,{className:"flex flex-row-reverse justify-between items-center",children:[t.jsxs(f,{className:"",variant:"outline",onClick:()=>window.history.back(),children:[t.jsx(z,{className:""}),"Go Back"]}),t.jsx(j,{children:"المعلومات الأساسية"})]}),t.jsxs(g,{className:"flex flex-wrap gap-2",children:[u&&Object.entries(u).map(([e,s])=>e==="id"?null:t.jsxs("p",{className:"flex gap-2 relative group mb-4 items-end",children:[t.jsxs("label",{className:"block font-bold w-36",children:[e=="payPrice"?"سعر الشراء":e=="unit"?"الواحدة":e=="updatedDate"?"اخر تعديل":e=="code"?"الرمز":e=="warehouse"?"المخزن":e=="sellPrice"?"سعر المبيع":e=="quantity"?"الكمية":e=="category"?"الفئة":e=="name"?"الاسم":e,":"]}),e.includes("date")&&new Date(s).toString()!=="Invalid Date"?t.jsx("input",{type:"text",value:new Date(s).toLocaleString("en-GB"),onChange:a=>N(e,a.target.value),className:"bg-transparent border-b-2 border-transparent focus:border-primary-500 outline-none transition-all w-full"}):t.jsx("input",{type:"text",value:s,onChange:a=>N(e,a.target.value),className:"bg-transparent border-b-2 border-transparent focus:border-primary-500 outline-none transition-all w-full"}),t.jsx("span",{className:"absolute bottom-0 right-0 w-full h-[2px] bg-primary-500 scale-x-0 group-hover:scale-x-100 origin-right transition-transform duration-300"})]},e)),t.jsxs("div",{className:"col-span-2 w-full grid grid-cols-2 gap-4",children:[C&&L&&t.jsx(f,{onClick:()=>m.mutate(u),disabled:m.isPending,children:m.isPending?"جارٍ الحفظ...":"حفظ التعديلات"}),t.jsx(f,{className:C?"":"col-span-2",variant:"destructive",onClick:()=>window.confirm("هل انت متأكد من عملية الحذف")?B.mutate(l.id):{},children:"حذف المنتج"})]})]})]}),t.jsxs(x,{children:[t.jsx(h,{children:t.jsx(j,{children:"نظرة عامة"})}),t.jsxs(g,{className:"grid md:grid-cols-2 gap-4",children:[t.jsx(q,{title:"المشتريات vs المبيعات vs المخزون",data:r?O(r):[],dataKey:"value",type:"pie"}),t.jsx(q,{title:"المرابح",type:"bar",data:r?A(r):[],dataKey:"profit"})]})]}),t.jsxs(x,{children:[t.jsx(h,{children:t.jsx(j,{children:"جداول البيانات"})}),t.jsxs(g,{className:"flex flex-row flex-wrap gap-4",children:[t.jsx(y,{className:"w-full md:w-[48%]",title:"عمليات الشراء",data:r?Object.values(r.transfers):[],columns:E}),t.jsx(y,{className:"w-full md:w-[48%]",title:"عمليات الشراء",data:r?Object.values(r.purchases):[],columns:F,onRowClick:e=>{d("/SupplierDetails",{state:{id:e.supplierId}})}}),t.jsx(y,{className:"w-full md:w-[48%]",title:"عمليات البيع",data:r?Object.values(r.sells):[],columns:Q,onRowClick:e=>{d("/customerDetails",{state:{id:e.customerId}})}})]})]})]})}export{le as default};
